window.CustomModernizr=function(a,b,c){function d(a){s.cssText=a}function e(a,b){return typeof a===b}function f(a,b){return!!~(""+a).indexOf(b)}function g(a,b){for(var d in a){var e=a[d];if(!f(e,"-")&&s[e]!==c)return"pfx"==b?e:!0}return!1}function h(a,b,d){for(var f in a){var g=b[a[f]];if(g!==c)return d===!1?a[f]:e(g,"function")?g.bind(d||b):g}return!1}function i(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),f=(a+" "+v.join(d+" ")+d).split(" ");return e(b,"string")||e(b,"undefined")?g(f,b):(f=(a+" "+w.join(d+" ")+d).split(" "),h(f,b,c))}var j,k,l,m="2.6.2",n={},o=!0,p=b.documentElement,q="modernizr",r=b.createElement(q),s=r.style,t=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),u="Webkit Moz O ms",v=u.split(" "),w=u.toLowerCase().split(" "),x={},y=[],z=y.slice,A=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:q+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',q,'">',a,"</style>"].join(""),j.id=q,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=p.style.overflow,p.style.overflow="hidden",p.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),p.style.overflow=i),!!g},B={}.hasOwnProperty;l=e(B,"undefined")||e(B.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return B.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=z.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(z.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(z.call(arguments)))};return d}),x.csstransforms=function(){return!!i("transform")},x.csstransforms3d=function(){var a=!!i("perspective");return a&&"webkitPerspective"in p.style&&A("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},x.csstransitions=function(){return i("transition")};for(var C in x)l(x,C)&&(k=C.toLowerCase(),n[k]=x[C](),y.push((n[k]?"":"no-")+k));return n.addTest=function(a,b){if("object"==typeof a)for(var d in a)l(a,d)&&n.addTest(d,a[d]);else{if(a=a.toLowerCase(),n[a]!==c)return n;b="function"==typeof b?b():b,"undefined"!=typeof o&&o&&(p.className+=" "+(b?"":"no-")+a),n[a]=b}return n},d(""),r=j=null,n._version=m,n._prefixes=t,n._domPrefixes=w,n._cssomPrefixes=v,n.testProp=function(a){return g([a])},n.testAllProps=i,n.testStyles=A,n.prefixed=function(a,b,c){return b?i(a,b,c):i(a,"pfx")},p.className=p.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(o?" js "+y.join(" "):""),n}(this,this.document),window.findAndReplaceDOMText=function(){function a(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function b(){return c.apply(null,arguments)||d.apply(null,arguments)}function c(a,c,e,f,g){if(c&&!c.nodeType&&arguments.length<=2)return!1;var h="function"==typeof e;h&&(e=function(a){return function(b,c){return a(b.text,c.startIndex)}}(e));var i=d(c,{find:a,wrap:h?null:e,replace:h?e:"$"+(f||"&"),prepMatch:function(a,b){if(!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(f>0){var c=a[f];a.index+=a[0].indexOf(c),a[0]=c}return a.endIndex=a.index+a[0].length,a.startIndex=a.index,a.index=b,a},filterElements:g});return b.revert=function(){return i.revert()},!0}function d(a,b){return new e(a,b)}function e(a,b){b.portionMode=b.portionMode||f,this.node=a,this.options=b,this.prepMatch=b.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}{var f="retain",g="first",h=document;({}).toString}return b.Finder=e,e.prototype={search:function(){var b,c=0,d=this.options.find,e=this.getAggregateText(),f=[];if(d="string"==typeof d?RegExp(a(d),"g"):d,d.global)for(;b=d.exec(e);)f.push(this.prepMatch(b,c++));else(b=e.match(d))&&f.push(this.prepMatch(b,0));return f},prepMatch:function(a,b){if(!a[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return a.endIndex=a.index+a[0].length,a.startIndex=a.index,a.index=b,a},getAggregateText:function(){function a(c){if(3===c.nodeType)return c.data;if(b&&!b(c))return"";var d="";if(c=c.firstChild)do d+=a(c);while(c=c.nextSibling);return d}var b=this.options.filterElements;return a(this.node)},processMatches:function(){var a,b,c,d=this.matches,e=this.node,f=this.options.filterElements,g=[],h=e,i=d.shift(),j=0,k=0,l=0,m=[e];a:for(;;){if(3===h.nodeType&&(!b&&h.length+j>=i.endIndex?b={node:h,index:l++,text:h.data.substring(i.startIndex-j,i.endIndex-j),indexInMatch:j-i.startIndex,indexInNode:i.startIndex-j,endIndexInNode:i.endIndex-j,isEnd:!0}:a&&g.push({node:h,index:l++,text:h.data,indexInMatch:j-i.startIndex,indexInNode:0}),!a&&h.length+j>i.startIndex&&(a={node:h,index:l++,indexInMatch:0,indexInNode:i.startIndex-j,endIndexInNode:i.endIndex-j,text:h.data.substring(i.startIndex-j,i.endIndex-j)}),j+=h.data.length),c=1===h.nodeType&&f&&!f(h),a&&b){if(h=this.replaceMatch(i,a,g,b),j-=b.node.data.length-b.endIndexInNode,a=null,b=null,g=[],i=d.shift(),l=0,k++,!i)break}else if(!c&&(h.firstChild||h.nextSibling)){h.firstChild?(m.push(h),h=h.firstChild):h=h.nextSibling;continue}for(;;){if(h.nextSibling){h=h.nextSibling;break}if(h=m.pop(),h===e)break a}}},revert:function(){for(var a=this.reverts.length;a--;)this.reverts[a]();this.reverts=[]},prepareReplacementString:function(a,b,c){var d=this.options.portionMode;return d===g&&b.indexInMatch>0?"":(a=a.replace(/\$(\d+|&|`|')/g,function(a,b){var d;switch(b){case"&":d=c[0];break;case"`":d=c.input.substring(0,c.startIndex);break;case"'":d=c.input.substring(c.endIndex);break;default:d=c[+b]}return d}),d===g?a:b.isEnd?a.substring(b.indexInMatch):a.substring(b.indexInMatch,b.indexInMatch+b.text.length))},getPortionReplacementNode:function(a,b,c){var d=this.options.replace||"$&",e=this.options.clss,f=this.options.wrap;if(f&&f.nodeType){var g=h.createElement("div");g.innerHTML=f.outerHTML||(new XMLSerializer).serializeToString(f),f=g.firstChild}if("function"==typeof d)return d=d(a,b,c),d&&d.nodeType?d:h.createTextNode(String(d));var i="string"==typeof f?h.createElement(f):f;return e&&(i.className=e),d=h.createTextNode(this.prepareReplacementString(d,a,b,c)),d.data&&i?(i.appendChild(d),i):d},replaceMatch:function(a,b,c,d){var e,f,g=b.node,i=d.node;if(g===i){var j=g;b.indexInNode>0&&(e=h.createTextNode(j.data.substring(0,b.indexInNode)),j.parentNode.insertBefore(e,j));var k=this.getPortionReplacementNode(d,a);return j.parentNode.insertBefore(k,j),d.endIndexInNode<j.length&&(f=h.createTextNode(j.data.substring(d.endIndexInNode)),j.parentNode.insertBefore(f,j)),j.parentNode.removeChild(j),this.reverts.push(function(){e===k.previousSibling&&e.parentNode.removeChild(e),f===k.nextSibling&&f.parentNode.removeChild(f),k.parentNode.replaceChild(j,k)}),k}e=h.createTextNode(g.data.substring(0,b.indexInNode)),f=h.createTextNode(i.data.substring(d.endIndexInNode));for(var l=this.getPortionReplacementNode(b,a),m=[],n=0,o=c.length;o>n;++n){var p=c[n],q=this.getPortionReplacementNode(p,a);p.node.parentNode.replaceChild(q,p.node),this.reverts.push(function(a,b){return function(){b.parentNode.replaceChild(a.node,b)}}(p,q)),m.push(q)}var r=this.getPortionReplacementNode(d,a);return g.parentNode.insertBefore(e,g),g.parentNode.insertBefore(l,g),g.parentNode.removeChild(g),i.parentNode.insertBefore(r,i),i.parentNode.insertBefore(f,i),i.parentNode.removeChild(i),this.reverts.push(function(){e.parentNode.removeChild(e),l.parentNode.replaceChild(g,l),f.parentNode.removeChild(f),r.parentNode.replaceChild(i,r)}),r}},b}(),function(a){function b(b,f){if(this.element=b,this.options=a.extend({},d,f),a(this.element).data("max-height",this.options.maxHeight),a(this.element).data("height-margin",this.options.heightMargin),delete this.options.maxHeight,this.options.embedCSS&&!e){var g=".readmore-js-toggle, .readmore-js-section { "+this.options.sectionCSS+" } .readmore-js-section { overflow: hidden; }";!function(a,b){var c=a.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=b:c.appendChild(a.createTextNode(b)),a.getElementsByTagName("head")[0].appendChild(c)}(document,g),e=!0}this._defaults=d,this._name=c,this.init()}var c="readmore",d={speed:100,maxHeight:200,heightMargin:16,moreLink:'<a href="#">Expand</a>',lessLink:'<a href="#">Collapse</a>',embedCSS:!0,sectionCSS:"display: block; width: 100%;",startOpen:!1,expandedClass:"readmore-js-expanded",collapsedClass:"readmore-js-collapsed",beforeToggle:function(){},afterToggle:function(){}},e=!1;b.prototype={init:function(){var b=this;a(this.element).each(function(){var c=a(this),d=c.css("max-height"),e=d.replace(/[^-\d\.]/g,"")>c.data("max-height")?d.replace(/[^-\d\.]/g,""):c.data("max-height"),f=c.data("height-margin");if("none"!=d&&c.css("max-height","none"),b.setBoxHeight(c),c.outerHeight(!0)<=e+f)return!0;c.addClass("readmore-js-section "+b.options.collapsedClass).data("collapsedHeight",e);var g=b.options.startOpen?b.options.lessLink:b.options.moreLink;c.after(a(g).on("click",function(a){b.toggleSlider(this,c,a)}).addClass("readmore-js-toggle")),b.options.startOpen||c.css({height:e})})},toggleSlider:function(b,c,d){d.preventDefault();var e=this,f=newLink=sectionClass="",g=!1,h=a(c).data("collapsedHeight");a(c).height()<=h?(f=a(c).data("expandedHeight")+"px",newLink="lessLink",g=!0,sectionClass=e.options.expandedClass):(f=h,newLink="moreLink",sectionClass=e.options.collapsedClass),e.options.beforeToggle(b,c,g),a(c).animate({height:f},{duration:e.options.speed,complete:function(){e.options.afterToggle(b,c,g),a(b).replaceWith(a(e.options[newLink]).on("click",function(a){e.toggleSlider(this,c,a)}).addClass("readmore-js-toggle")),a(this).removeClass(e.options.collapsedClass+" "+e.options.expandedClass).addClass(sectionClass)}})},setBoxHeight:function(a){var b=a.clone().css({height:"auto",width:a.width(),overflow:"hidden"}).insertAfter(a),c=b.outerHeight(!0);b.remove(),a.data("expandedHeight",c)},resizeBoxes:function(){var b=this;a(".readmore-js-section").each(function(){var c=a(this);b.setBoxHeight(c),(c.height()>c.data("expandedHeight")||c.hasClass(b.options.expandedClass)&&c.height()<c.data("expandedHeight"))&&c.css("height",c.data("expandedHeight"))})},destroy:function(){var b=this;a(this.element).each(function(){var c=a(this);c.removeClass("readmore-js-section "+b.options.collapsedClass+" "+b.options.expandedClass).css({"max-height":"",height:"auto"}).next(".readmore-js-toggle").remove(),c.removeData()})}},a.fn[c]=function(d){var e=arguments;return void 0===d||"object"==typeof d?this.each(function(){if(a.data(this,"plugin_"+c)){var e=a.data(this,"plugin_"+c);e.destroy.apply(e)}a.data(this,"plugin_"+c,new b(this,d))}):"string"==typeof d&&"_"!==d[0]&&"init"!==d?this.each(function(){var f=a.data(this,"plugin_"+c);f instanceof b&&"function"==typeof f[d]&&f[d].apply(f,Array.prototype.slice.call(e,1))}):void 0}}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery","modernizr"],a):a(window.jQuery,window.CustomModernizr)}(function(a,b,c){"use strict";function d(a){return a?a.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}).replace(/^ms-/,"-ms-"):""}function e(b,c,d){var e,f,g,h=null,i=0;d=d||{};var j=function(){i=d.leading===!1?0:a.now(),h=null,g=b.apply(e,f),e=f=null};return function(){var k=a.now();i||d.leading!==!1||(i=k);var l=c-(k-i);return e=this,f=arguments,0>=l||l>c?(clearTimeout(h),h=null,i=k,g=b.apply(e,f),e=f=null):h||d.trailing===!1||(h=setTimeout(j,l)),g}}if("object"!=typeof b)throw new Error("Shuffle.js requires Modernizr.\nhttp://vestride.github.io/Shuffle/#dependencies");var f=b.prefixed("transition"),g=b.prefixed("transitionDelay"),h=b.prefixed("transitionDuration"),i={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[f],j=b.prefixed("transform"),k=d(j),l=b.csstransforms&&b.csstransitions,m=b.csstransforms3d,n="shuffle",o="all",p="groups",q=1,r=.001,s=0,t=function(b,c){c=c||{},a.extend(this,t.options,c,t.settings),this.$el=a(b),this.$window=a(window),this.unique="shuffle_"+s++,this._fire(t.EventType.LOADING),this._init(),setTimeout(a.proxy(function(){this.initialized=!0,this._fire(t.EventType.DONE)},this),16)};return t.EventType={LOADING:"loading",DONE:"done",SHRINK:"shrink",SHRUNK:"shrunk",FILTER:"filter",FILTERED:"filtered",SORTED:"sorted",LAYOUT:"layout",REMOVED:"removed"},t.prototype={_init:function(){var b,c,d=this,e=a.proxy(d._onResize,d),g=d.throttle?d.throttle(e,d.throttleTime):e,h=d.initialSort?d.initialSort:null;d._layoutList=[],d._shrinkList=[],d._setVars(),d._resetCols(),d._addClasses(),d._initItems(),d.$window.on("resize."+n+"."+d.unique,g),b=d.$el.css(["paddingLeft","paddingRight","position"]),c=d._getOuterWidth(d.$el[0]),"static"===b.position&&(d.$el[0].style.position="relative"),d.offset={left:parseInt(b.paddingLeft,10)||0,top:parseInt(b.paddingTop,10)||0},d._setColumns(parseInt(c,10)),d.itemMargin=d._getPreciseDimension(d.sizer,"marginLeft")||0,d.shuffle(d.group,h),d.supported&&setTimeout(function(){d._setTransitions(),d.$el[0].style[f]="height "+d.speed+"ms "+d.easing},0)},_addClasses:function(){this.$el.addClass(n),this.$items.addClass("shuffle-item filtered")},_setVars:function(){var b=this,c=b.columnWidth;b.$items=b._getItems(),0===c&&null!==b.sizer&&(c=b.sizer),"string"==typeof c?b.$sizer=b.$el.find(c):c&&c.nodeType&&1===c.nodeType?b.$sizer=a(c):c&&c.jquery&&(b.$sizer=c),b.$sizer&&b.$sizer.length&&(b.useSizer=!0,b.sizer=b.$sizer[0])},_filter:function(b,d){var e=this,f=d!==c,g=f?d:e.$items,h=a();return b=b||e.lastFilter,e._fire(t.EventType.FILTER),a.isFunction(b)?g.each(function(){var c=a(this);b.call(c[0],c,e)&&(h=h.add(c))}):(e.group=b,b===o?h=g:g.each(function(){var c=a(this),d=c.data(p),f=e.delimeter&&!a.isArray(d)?d.split(e.delimeter):d;a.inArray(b,f)>-1&&(h=h.add(c))})),e._toggleFilterClasses(g,h),g=null,d=null,h},_toggleFilterClasses:function(b,c){var d="concealed",e="filtered";b.filter(c).each(function(){var b=a(this);b.hasClass(d)&&b.removeClass(d),b.hasClass(e)||b.addClass(e)}),b.not(c).each(function(){var b=a(this);b.hasClass(d)||b.addClass(d),b.hasClass(e)&&b.removeClass(e)})},_initItems:function(a){a=a||this.$items,a.css(this.itemCss).data("position",{x:0,y:0})},_updateItemCount:function(){this.visibleItems=this.$items.filter(".filtered").length},_setTransition:function(a){a.style[f]=k+" "+this.speed+"ms "+this.easing+", opacity "+this.speed+"ms "+this.easing},_setTransitions:function(a){var b=this;a=a||b.$items,a.each(function(){b._setTransition(this)})},_setSequentialDelay:function(b){var c=this;c.supported&&a.each(b,function(b,d){d.style[g]="0ms,"+(b+1)*c.sequentialFadeDelay+"ms",a(d).on(i+"."+c.unique,function(b){var d=b.currentTarget;d===b.target&&(d.style[g]="0ms",a(d).off(i+"."+c.unique))})})},_getItems:function(){return this.$el.children(this.itemSelector)},_getPreciseDimension:function(b,c){var d;return d=a(b).css(c),parseFloat(d)},_getOuterWidth:function(b,c){var d=b.offsetWidth;if(c){var e=a(b).css(["marginLeft","marginRight"]),f=parseFloat(e.marginLeft)||0,g=parseFloat(e.marginRight)||0;d+=f+g}return d},_getColumnSize:function(b,c){var d;return d=a.isFunction(this.columnWidth)?this.columnWidth(c):this.useSizer?this._getPreciseDimension(this.sizer,"width"):this.columnWidth?this.columnWidth:this.$items.length>0?this._getOuterWidth(this.$items[0],!0):c,0===d&&(d=c),d+b},_getGutterSize:function(b){var c;return c=a.isFunction(this.gutterWidth)?this.gutterWidth(b):this.useSizer?this._getPreciseDimension(this.sizer,"marginLeft"):this.gutterWidth},_setColumns:function(a){var b=a||this._getOuterWidth(this.$el[0]),c=this._getGutterSize(b),d=this._getColumnSize(c,b),e=(b+c)/d;Math.abs(Math.round(e)-e)<.03&&(e=Math.round(e)),this.cols=Math.max(Math.floor(e),1),this.containerWidth=b,this.colWidth=d},_setContainerSize:function(){this.$el.css("height",Math.max.apply(Math,this.colYs))},_fire:function(a,b){this.$el.trigger(a+"."+n,b&&b.length?b:[this])},_layout:function(b,c,d){var e=this;c=c||e._filterEnd,a.each(b,function(b,f){var g=a(f),h=g.data(),i=h.position,j=e._getItemPosition(g);if(g.data("position",j),j.x!==i.x||j.y!==i.y||h.scale!==q){var k={$item:g,x:j.x,y:j.y,scale:q};d?(k.skipTransition=!0,k.opacity=0):(k.opacity=1,k.callback=c),e.styleQueue.push(k),e._layoutList.push(g[0])}}),e._processStyleQueue(),e._setContainerSize()},_resetCols:function(){var a=this.cols;for(this.colYs=[];a--;)this.colYs.push(0)},_reLayout:function(){this._resetCols(),this.lastSort?this.sort(this.lastSort,!0):this._layout(this.$items.filter(".filtered").get(),this._filterEnd)},_getItemPosition:function(a){var b=this,c=b._getOuterWidth(a[0],!0),d=c/b.colWidth;Math.abs(Math.round(d)-d)<.03&&(d=Math.round(d));var e=Math.min(Math.ceil(d),b.cols),f=Math.round((b.containerWidth-(c*b.cols+b.itemMargin*(b.cols-1)))/2);if(1===e)return b._placeItem(a,b.colYs,f);var g,h,i=b.cols+1-e,j=[];for(h=0;i>h;h++)g=b.colYs.slice(h,h+e),j[h]=Math.max.apply(Math,g);return b._placeItem(a,j,f)},_placeItem:function(a,b,c){for(var d=this,e=Math.min.apply(Math,b),f=0,g=0,h=b.length;h>g;g++)if(b[g]>=e-d.buffer&&b[g]<=e+d.buffer){f=g;break}var i={x:Math.round(d.colWidth*f+d.offset.left)+c,y:Math.round(e+d.offset.top)},j=e+a.outerHeight(!0),k=d.cols+1-h;for(g=0;k>g;g++)d.colYs[f+g]=j;return i},_shrink:function(b,c){var d=this,e=b||d.$items.filter(".concealed");c=c||d._shrinkEnd,e.length&&(d._fire(t.EventType.SHRINK),e.each(function(){var b=a(this),e=b.data(),f=e.scale===r;if(!f){var g={$item:b,x:e.position.x,y:e.position.y,scale:r,opacity:0,callback:c};d.styleQueue.push(g),d._shrinkList.push(b[0])}}))},_onResize:function(){if(this.enabled&&!this.destroyed){var a=this._getOuterWidth(this.$el[0]);a!==this.containerWidth&&this.resized()}},_getItemTransformString:function(a,b,c){return m?"translate3d("+a+"px, "+b+"px, 0) scale3d("+c+", "+c+", 1)":"translate("+a+"px, "+b+"px) scale("+c+", "+c+")"},_getStylesForTransition:function(a){var b={opacity:a.opacity};return this.supported?a.x!==c&&(b[j]=this._getItemTransformString(a.x,a.y,a.scale)):(b.left=a.x,b.top=a.y),1===a.opacity&&(b.visibility="visible"),b},_transition:function(a){a.$item.data("scale",a.scale);var b=this._getStylesForTransition(a);this._startItemAnimation(a.$item,b,a.callback)},_startItemAnimation:function(b,c,d){var e=1===c.opacity,f=a.proxy(this._handleItemAnimationEnd,this,d||a.noop,b[0],e);this.supported?(b.css(c),this.initialized?b.on(i+".shuffleitem",f):f()):("visibility"in c&&(b.css("visibility",c.visibility),delete c.visibility),b.stop(!0).animate(c,this.speed,"swing",f))},_handleItemAnimationEnd:function(b,c,d,e){if(e){if(e.target!==c)return;a(c).off(".shuffleitem")}this._layoutList.length>0&&a.inArray(c,this._layoutList)>-1?(this._fire(t.EventType.LAYOUT),b.call(this),this._layoutList.length=0):this._shrinkList.length>0&&a.inArray(c,this._shrinkList)>-1&&(b.call(this),this._shrinkList.length=0),d||(c.style.visibility="hidden")},_processStyleQueue:function(){var b=this;a.each(this.styleQueue,function(a,c){c.skipTransition?b._skipTransition(c.$item[0],function(){c.$item.css(b._getStylesForTransition(c))}):b._transition(c)}),b.styleQueue.length=0},_shrinkEnd:function(){this._fire(t.EventType.SHRUNK)},_filterEnd:function(){this._fire(t.EventType.FILTERED)},_sortEnd:function(){this._fire(t.EventType.SORTED)},_skipTransition:function(b,c,d){var e=b.style[h];b.style[h]="0ms",a.isFunction(c)?c():b.style[c]=d;var f=b.offsetWidth;f=null,b.style[h]=e},_addSlideShowItems:function(a,b,d){var e=this;e.supported||(b=!1),a.addClass("shuffle-item"),e._initItems(a),e._setTransitions(a),e.$items=e._getItems(),a.css("opacity",0);var f=e._filter(c,a),g=f.get();e._updateItemCount(),b?(e._layout(g,null,!0),d&&e._setSequentialDelay(f),e._revealAppended(f)):e._layout(g)},_revealAppended:function(b){var c=this;setTimeout(function(){b.each(function(b,d){c._transition({$item:a(d),opacity:1,scale:q})})},c.revealAppendedDelay)},shuffle:function(a,b){var c=this;c.enabled&&(a||(a=o),c._filter(a),c.lastFilter=a,c._updateItemCount(),c._shrink(),b&&(c.lastSort=b),c._reLayout())},sort:function(a,b){var c=this,d=c.$items.filter(".filtered").sorted(a);b||c._resetCols(),c._layout(d,function(){b&&c._filterEnd(),c._sortEnd()}),c.lastSort=a},resized:function(a){this.enabled&&(a||this._setColumns(),this._reLayout())},layout:function(){this.update(!0)},update:function(a){this.resized(a)},appended:function(a,b,c){b=b===!1?!1:!0,c=c===!1?!1:!0,this._addSlideShowItems(a,b,c)},disable:function(){this.enabled=!1},enable:function(a){this.enabled=!0,a!==!1&&this.update()},remove:function(a){if(a.length&&a.jquery){var b=this;return b._shrink(a,function(){var b=this;a.remove(),setTimeout(function(){b.$items=b._getItems(),b.layout(),b._updateItemCount(),b._fire(t.EventType.REMOVED,[a,b]),a=null},0)}),b._processStyleQueue(),b}},destroy:function(){var a=this;a.$window.off("."+a.unique),a.$el.removeClass(n).removeAttr("style").removeData(n),a.$items.removeAttr("style").removeClass("concealed filtered shuffle-item"),a.$window=null,a.$items=null,a.$el=null,a.$sizer=null,a.sizer=null,a.destroyed=!0}},t.options={group:o,speed:250,easing:"ease-out",itemSelector:"",sizer:null,gutterWidth:0,columnWidth:0,delimeter:null,buffer:0,initialSort:null,throttle:e,throttleTime:300,sequentialFadeDelay:150,supported:l},t.settings={$sizer:null,useSizer:!1,itemCss:{position:"absolute",top:0,left:0},offset:{top:0,left:0},revealAppendedDelay:300,enabled:!0,destroyed:!1,initialized:!1,styleQueue:[]},a.fn.shuffle=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),e=d.data(n);e||(e=new t(d,b),d.data(n,e)),"string"==typeof b&&e[b]&&e[b].apply(e,c)})},a.fn.sorted=function(b){var d=a.extend({},a.fn.sorted.defaults,b),e=this.get(),f=!1;return e.length?d.randomize?a.fn.sorted.randomize(e):(d.by!==a.noop&&null!==d.by&&d.by!==c&&e.sort(function(b,e){if(f)return 0;var g=d.by(a(b)),h=d.by(a(e));return g===c&&h===c?(f=!0,0):"sortFirst"===g||"sortLast"===h?-1:"sortLast"===g||"sortFirst"===h?1:h>g?-1:g>h?1:0}),f?this.get():(d.reverse&&e.reverse(),e)):[]},a.fn.sorted.defaults={reverse:!1,by:null,randomize:!1},a.fn.sorted.randomize=function(a){var b,c,d=a.length;if(!d)return a;for(;--d;)c=Math.floor(Math.random()*(d+1)),b=a[c],a[c]=a[d],a[d]=b;return a},t}),function(a,b){var c,d=a.jQuery||a.Cowboy||(a.Cowboy={});d.throttle=c=function(a,c,e,f){function g(){function d(){i=+new Date,e.apply(j,l)}function g(){h=b}var j=this,k=+new Date-i,l=arguments;f&&!h&&d(),h&&clearTimeout(h),f===b&&k>a?d():c!==!0&&(h=setTimeout(f?g:d,f===b?a-k:a))}var h,i=0;return"boolean"!=typeof c&&(f=e,e=c,c=b),d.guid&&(g.guid=e.guid=e.guid||d.guid++),g},d.debounce=function(a,d,e){return e===b?c(a,d,!1):c(a,e,d!==!1)}}(this),function(a){"use strict";var b=null,c=a(window),d=function(b){var c=this;if(a.extend(c,d.options,b,d.settings),!a.isFunction(c.enter))throw new TypeError("Viewport.add :: No `enter` function provided in Viewport options.");"string"==typeof c.threshold&&c.threshold.indexOf("%")>-1?(c.isThresholdPercentage=!0,c.threshold=parseFloat(c.threshold)/100):c.threshold<1&&c.threshold>0&&(c.isThresholdPercentage=!0),c.hasLeaveCallback=a.isFunction(c.leave),c.$element=a(c.element),c.update()};d.prototype.update=function(){var a=this;a.offset=a.$element.offset(),a.height=a.$element.height(),a.width=a.$element.width()},d.options={threshold:200,delay:0},d.settings={triggered:!1,isThresholdPercentage:!1};var e=function(){this.init()};e.prototype={init:function(){var a=this;a.list=[],a.lastScrollY=0,a.windowHeight=c.height(),a.windowWidth=c.width(),a.throttleTime=100,a.onResize(),a.bindEvents(),a.willProcessNextFrame=!0,requestAnimationFrame(function(){a.setScrollTop(),a.process(),a.willProcessNextFrame=!1})},bindEvents:function(){var b,d=this;b=function(){setTimeout(function(){d.refresh()},0)},c.on("resize.viewport",a.proxy(d.onResize,d)),c.on("scroll.viewport",a.throttle(d.throttleTime,a.proxy(d.onScroll,d))),d.hasActiveHandlers=!0},unbindEvents:function(){c.off(".viewport"),this.hasActiveHandlers=!1},maybeUnbindEvents:function(){var a=this;a.list.length||a.unbindEvents()},add:function(a){var b=this;b.list.push(a),b.hasActiveHandlers||b.bindEvents(),b.willProcessNextFrame||(b.willProcessNextFrame=!0,requestAnimationFrame(function(){b.willProcessNextFrame=!1,b.process()}))},saveDimensions:function(){var b=this;a.each(b.list,function(a,b){b.update()}),b.windowHeight=c.height(),b.windowWidth=c.width()},onScroll:function(){var a=this;a.list.length&&(a.setScrollTop(),a.process())},onResize:function(){this.refresh()},refresh:function(){this.list.length&&this.saveDimensions()},isInViewport:function(a){var b,c=this,d=a.offset,e=a.threshold,f=e,g=c.lastScrollY;return a.isThresholdPercentage&&(e=0),b=c.isTopInView(g,c.windowHeight,d.top,a.height,e),b&&a.isThresholdPercentage&&(b=c.isTopPastPercent(g,c.windowHeight,d.top,a.height,f)),b},isTopInView:function(a,b,c,d,e){var f=a+b;return c+e>=a&&f>c+e},isTopPastPercent:function(a,b,c,d,e){var f=a+b,g=f-c,h=g/b;return h>=e},isOutOfViewport:function(a,b){var c,d=this,e=a.offset,f=d.lastScrollY;return"bottom"===b&&(c=!d.isBottomInView(f,d.windowHeight,e.top,a.height)),c},isBottomInView:function(a,b,c,d){var e=a+b,f=c+d;return f>a&&e>=f},triggerEnter:function(b){var c=this;setTimeout(function(){b.enter.call(b.element,b)},b.delay),a.isFunction(b.leave)?b.triggered=!0:c.list.splice(a.inArray(b,c.list),1),c.maybeUnbindEvents()},triggerLeave:function(a){setTimeout(function(){a.leave.call(a.element,a)},a.delay),a.triggered=!1},setScrollTop:function(){this.lastScrollY=c.scrollTop()},process:function(){var b=this,c=a.extend([],b.list);a.each(c,function(a,c){var d=b.isInViewport(c),e=c.hasLeaveCallback&&b.isOutOfViewport(c,"bottom");return!c.triggered&&d?b.triggerEnter(c):!d&&e&&c.triggered?b.triggerLeave(c):void 0})}},e.add=function(a){var b=e.getInstance();return b.add(new d(a))},e.refresh=function(){e.getInstance().refresh()},e.getInstance=function(){return b||(b=new e),b},window.FF_Viewport=e}(jQuery),function(a,b,c){"use strict";function d(a,b){a.style.WebkitTransform=b,a.style.msTransform=b,a.style.transform=b}function e(){var b=h.clientWidth,c=a.innerWidth;return c>b?c:b}function f(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function g(a,b){this.el=a[0],this.$el=a,this.options=f({},this.options),f(this.options,b),this._init()}var h=a.document.documentElement,i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},j=i[b.prefixed("transition")],k={transitions:b.csstransitions,support3d:b.csstransforms3d};g.prototype.options={},g.prototype._init=function(){this.grid=this.el.querySelector(".ff-stream-wrapper"),this.gridItems=[].slice.call(this.grid.querySelectorAll(".ff-item")),this.itemsCount=this.gridItems.length,this.slideshow=this.el.querySelector(".ff-slideshow > ul"),this.$slideshow=c(this.slideshow),this.$slideshow.data("media",!1),this._addSlideShowItems(),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector(".ff-nav-prev"),this.ctrlNext=this.el.querySelector(".ff-nav-next"),this.ctrlClose=this.el.querySelector(".ff-nav-close"),this._initEvents()},g.prototype._addSlideShowItems=function(){var a=this;a.gridItems.forEach(function(b){var d,e,f,g=c(b),h=c('<li><div class="ff-slide-wrapper"></div></li>'),i=h.find(".ff-slide-wrapper"),j=g.find(".picture-item__inner").children().clone(),k="";g.attr("data-media")?(a.$slideshow.data("media",!0),f=g.attr("data-media").split(";"),d=c('<div class="ff-media-wrapper'+("image"==f[3]?"":" ff-video")+'" style="width: 100%; max-height: '+f[1]+'px;"></div>'),i.prepend(d),"image"==f[3]?k='<span class="ff-img-holder" style="width: '+f[0]+"px; max-height: "+f[1]+"px; height: "+f[1]+"px; background-image: url("+f[2]+');"></span>':"video/mp4"==f[3]?k='<video controls width="'+f[0]+'" height="'+f[1]+'"><source src="'+f[2]+'" type="video/mp4">Your browser does not support the video tag.</video>':(f[2]=f[2].replace("http:","").replace("https:","").replace("/v/","/embed/"),k='<iframe width="'+f[0]+'" height="'+f[1]+'" src="'+f[2]+'" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe>'),d.data("media",k),j.find(".ff-img-holder").remove()):j.find(".ff-img-holder").length&&j.find(".ff-img-holder").each(function(){var a=c(this),b=c(this).find("img"),d=b.get(0);a.removeClass("ff-img-loading").addClass("ff-img-loaded").css({"background-image":'url("'+d.src+'")',width:parseInt(d.style.width),height:parseInt(d.style.height)}),b.remove()}),i.append(j.not(".ff-img-holder")),e=i.find(".ff-item-cont"),e.append(h.find("h4")),e.append(h.find(".ff-article")),e.append(h.find("p").prepend(h.find(".ff-img-holder"))),e.append(h.find(".ff-item-meta")),e.find(".ff-userpic").append(h.find(".ff-icon")),e.find(".ff-timestamp").before("<br>").before('<span class="ff-posted">Posted on <span>'+g.attr("data-type")+"</span></span>"),h.find("p").each(function(){var a=c(this);a.is(":empty")?a.remove():a.wrap('<div class="ff-table"/>')}),a.$slideshow.append(h)}),a.$slideshow.data("media")&&a.$slideshow.addClass("ff-slideshow-media")},g.prototype._initEvents=function(){var b=this;this.gridItems.forEach(function(a,d){c(a).on("click",function(a){var e=c(a.target),f=e.closest("a");(!f.length||e.is("img")&&!f.is(".ff-article"))&&(a.preventDefault(),b._openSlideshow(d))})}),c(this.ctrlPrev).on("click",function(){b._navigate("prev")}),c(this.ctrlNext).on("click",function(){b._navigate("next")}),c(this.ctrlClose).on("click",function(){b._closeSlideshow()}),this.$slideshow.on("click",function(a){c(a.target).closest("li, nav").length||b._closeSlideshow()}),c(a).on("resize",function(){b._resizeHandler()}),c(document).on("keydown",function(a){if(b.isSlideshowVisible){var c=a.keyCode||a.which;switch(c){case 37:b._navigate("prev");break;case 39:b._navigate("next");break;case 27:b._closeSlideshow()}}}),c("body").bind("mousewheel DOMMouseScroll",function(a){b.isSlideshowVisible&&("mousewheel"==a.type||"DOMMouseScroll"==a.type)&&a.preventDefault()})},g.prototype._openSlideshow=function(a){this.isSlideshowVisible=!0,this.current=a,this.$el.addClass("ff-slideshow-open"),this._setViewportItems();var b=c(this.currentItem),f=c(this.nextItem),g=c(this.prevItem),h=e();if(b.add(f).add(g).find(".ff-media-wrapper").each(function(){var a=c(this);a.data("media")&&"inserted"!==a.data("media")&&(a.prepend(a.data("media")),a.data("media","inserted"))}),b.addClass("ff-current"),b.addClass("ff-show"),d(this.currentItem,k.support3d?"translate3d("+parseInt(Number(-1*(this.currentItem.offsetWidth/2)))+"px, "+parseInt(Number(-1*(this.currentItem.offsetHeight/2)))+"px, 0px)":"translate(-50%, -50%)"),this.prevItem){g.addClass("ff-show");var i=Number(-1*(h/2+this.prevItem.offsetWidth/2));d(this.prevItem,k.support3d?"translate3d("+i+"px, -50%, -150px)":"translate("+i+"px, -50%)")}if(this.nextItem){f.addClass("ff-show");var i=Number(h/2+this.nextItem.offsetWidth/2);d(this.nextItem,k.support3d?"translate3d("+i+"px,-50%, -150px)":"translate("+i+"px, -50%)")}},g.prototype._navigate=function(a){if(!this.isAnimating){if("next"===a&&this.current===this.itemsCount-1||"prev"===a&&0===this.current)return void this._closeSlideshow();this.isAnimating=!0,this._setViewportItems();var b,f,g,h=this,i=e(),l=this.currentItem.offsetWidth,m=k.support3d?"translate3d(-"+Number(i/2+l/2)+"px, -50%, -150px)":"translate(-"+Number(i/2+l/2)+"px, -50%)",n=k.support3d?"translate3d("+Number(i/2+l/2)+"px, -50%, -150px)":"translate("+Number(i/2+l/2)+"px, -50%)";"next"===a?(b=k.support3d?"translate3d( -"+Number(2*i/2+l/2)+"px, -50%, -150px )":"translate(-"+Number(2*i/2+l/2)+"px, -50%)",f=k.support3d?"translate3d( "+Number(2*i/2+l/2)+"px, -50%, -150px )":"translate("+Number(2*i/2+l/2)+"px, -50%)"):(b=k.support3d?"translate3d( "+Number(2*i/2+l/2)+"px, -50%, -150px )":"translate("+Number(2*i/2+l/2)+"px)",f=k.support3d?"translate3d( -"+Number(2*i/2+l/2)+"px, -50%, -150px )":"translate(-"+Number(2*i/2+l/2)+"px, -50%)"),h.$slideshow.removeClass("ff-animatable"),("next"===a&&this.current<this.itemsCount-2||"prev"===a&&this.current>1)&&(g=this.slideshowItems["next"===a?this.current+2:this.current-2],d(g,f),c(g).addClass("ff-show").find(".ff-media-wrapper").each(function(){var a=c(this);
a.data("media")&&"inserted"!==a.data("media")&&(a.prepend(a.data("media")),a.data("media","inserted"))}));var o=function(){h.$slideshow.addClass("ff-animatable"),c(h.currentItem).removeClass("ff-current");var e="next"===a?h.nextItem:h.prevItem;c(e).addClass("ff-current"),d(h.currentItem,"next"===a?m:n),h.nextItem&&d(h.nextItem,"next"===a?k.support3d?"translate3d("+parseInt(Number(-1*(h.nextItem.offsetWidth/2)))+"px, "+parseInt(Number(-1*(h.nextItem.offsetHeight/2)))+"px, 0px)":"translate(-50%, -50%)":b),h.prevItem&&d(h.prevItem,"next"===a?b:k.support3d?"translate3d("+parseInt(Number(-1*(h.prevItem.offsetWidth/2)))+"px, "+parseInt(Number(-1*(h.prevItem.offsetHeight/2)))+"px, 0px)":"translate(-50%, -50%)"),g&&d(g,"next"===a?n:m);var f=function(b){if(k.transitions&&i>=800){if(-1===b.originalEvent.propertyName.indexOf("transform"))return!1;c(this).off(j,f)}h.prevItem&&"next"===a?c(h.prevItem).removeClass("ff-show"):h.nextItem&&"prev"===a&&c(h.nextItem).removeClass("ff-show"),h._resetYoutube(c(h.currentItem)),"next"===a?(h.prevItem=h.currentItem,h.currentItem=h.nextItem,g&&(h.nextItem=g)):(h.nextItem=h.currentItem,h.currentItem=h.prevItem,g&&(h.prevItem=g)),h.current="next"===a?h.current+1:h.current-1,h.isAnimating=!1};k.transitions&&i>=800?c(h.currentItem).on(j,f):f()};setTimeout(o,25)}},g.prototype._closeSlideshow=function(){this.$el.removeClass("ff-slideshow-open"),this.$slideshow.removeClass("ff-animatable");var a=this,b=function(e){if(k.transitions){if("ul"!==e.target.tagName.toLowerCase())return;c(this).off(j,b)}var f=c(a.currentItem);f.removeClass("ff-current"),f.removeClass("ff-show"),a._resetYoutube(f),a.prevItem&&c(a.prevItem).removeClass("ff-show"),a.nextItem&&c(a.nextItem).removeClass("ff-show"),a.slideshowItems.forEach(function(a){d(a,"")}),a.isSlideshowVisible=!1};k.transitions?c(this.el).on(j,b):b()},g.prototype._resetYoutube=function(a){var b=a.find("iframe");a.find(".ff-video").prepend(b)},g.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,this.current>0&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current]},g.prototype._resizeHandler=function(){function a(){b._resize(),b._resizeTimeout=null}var b=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(a,50)},g.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var a=Number(-1*(e()/2+this.prevItem.offsetWidth/2));d(this.prevItem,k.support3d?"translate3d("+a+"px, -50%, -150px)":"translate("+a+"px, -50%)")}if(this.nextItem){var a=Number(e()/2+this.nextItem.offsetWidth/2);d(this.nextItem,k.support3d?"translate3d("+a+"px, -50%, -150px)":"translate("+a+"px, -50%)")}}},a.CBPGridGallery=g}(window,window.CustomModernizr,window.jQuery),function(a){"use strict";function b(a){if(document.createEvent){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!1),a.dispatchEvent(b)}else document.createEventObject?a.fireEvent("onclick"):"function"==typeof a.onclick&&a.onclick()}var c,d,e=a("html"),f=navigator.userAgent.toLowerCase(),g=/safari|chrome/.test(f),h=/android|blackBerry|iphone|ipad|ipod|opera mini|iemobile/i.test(f),i=/msie|trident.*rv\:11\./.test(f),j=/firefox/.test(f),k=!1;if(i){if(/msie 8/.test(f))return;c=/msie 9/.test(f)}e.addClass("ff-browser-"+(g?"webkit":i?"ie"+(c?" ff-ie9":""):j?"ff":"")),a.expr.createPseudo&&"function"==typeof a.expr.createPseudo?a.expr[":"].contains=a.expr.createPseudo(function(b){return function(c){return a(c).text().toUpperCase().indexOf(b.toUpperCase())>=0}}):jQuery.expr[":"].contains=function(a,b,c){return jQuery(a).text().toUpperCase().indexOf(c[3].toUpperCase())>=0};var l=function(a){function c(){return a(document).bind("ffimgloaded",function(a,b){var c=b.$grid.data("shuffle");c&&c.layout()}),c=function(){return l},l}function e(c){var d,e,f,j,k,l,m,n="",o=t.streams["id"+c.id],q="grid"===o.layout&&"flat"===o.theme;if(!o.feeds||"[]"===o.feeds)return"No feeds to show. Add at least one";if(!o.layout||!o.theme)return"Please choose stream layout on options page";o.feeds=JSON.parse(o.feeds),j=o.feeds;var r,s=c.items,u=0,v=s.length,w=a('[id^="ff-uid-"]').length+1||1;if("yep"!==o.gallery||h||(n+='<section class="ff-slideshow"><ul></ul><nav><span class="ff-nav-prev"></span><span class="icon ff-nav-next"></span><span class="ff-nav-close"></span></nav><div class="ff-nav-info-keys">Navigate with arrow keys</div></section>'),n+='<div class="ff-header">',o.heading&&(n+="<h1>"+o.heading+"</h1>"),o.subheading&&(n+="<h2>"+o.subheading+"</h2>"),"yep"===o.filter){for(k="",l={},m=0,u=0;v>u;u++)l[s[u].type]=1;for(var x in l)m+=1,k+='<span class="ff-filter ff-type-'+x+'" data-filter="'+x+'"></span>';n+='<div class="ff-filter-holder">'+(m>1?'<span class="ff-filter ff-type-all">'+t.filterall+"</span>"+k:"")+'<span class="ff-search"><input type="text" '+("grid"===o.layout?'placeholder="Search"':"")+"/></span></div>"}n+="</div>",f="grid"===o.layout?o[o.layout.charAt(0)+o.theme.charAt(0)+"-style"]:o["compact-style"];var y="grid"===o.layout?"ff-theme-"+o.theme:"";for(n+='<div class="ff-stream-wrapper '+y+" ff-"+(h?"mobile":"desktop")+" ff-"+(f||"nostyle")+" shuffle--container"+("grid"===o.layout&&"yep"===o.viewportin&&!h&&window.requestAnimationFrame?" shuffle--animatein":" shuffle--animateoff")+" ff-c-"+o.cmeta+'">',u=0;v>u;u++){if(r=s[u],m=u+1,n+='<div class="ff-item'+(r.media&&"image"!=r.media.type?" ff-video-preview":"")+" ff-"+r.type+'" id="ff-uid-'+w+'" data-type="'+r.type+'" data-index="'+m+'"'+(r.media?' data-media="'+r.media.width+";"+r.media.height+";"+r.media.url+";"+r.media.type+'"':"")+'><div class="picture-item__inner"><div class="ff-item-cont">'+(r.header?'<h4><a rel="nofollow" href="'+r.permalink+'">'+r.header+"</a></h4>":"")+(r.img?'<span class="ff-img-holder ff-img-loading ff-no-margin" style="width:100%;max-height:'+r.img.height+'px;"><img src="'+r.img.url+'" style="width:'+r.img.width+"px;height:"+r.img.height+'px;" /></span>':"")+"<p>"+r.text+"</p>",r.attachments)for(var z=0;z<r.attachments.length;z++)"article"==r.attachments[z].type&&(n+='<a href="'+r.attachments[z].url+'" class="ff-article">',r.attachments[z].image&&(n+='<img src="'+r.attachments[z].image.url+'" style="width:'+r.attachments[z].image.width+"px;height:"+r.attachments[z].image.height+'px;" />'),n+="</a>",n+='<div class="ff-article">'+r.attachments[z].displayName+"</div>");n+='<div class="ff-item-meta"><span class="ff-userpic" style="background:url('+r.userpic+')"><i class="ff-icon"><i class="ff-icon-inner"></i></i></span><a rel="nofollow" href="'+r.userlink+'" class="ff-name '+(r.userlink?"":" ff-no-link")+'">'+r.screenname+"</a>"+(r.nickname?'<a rel="nofollow" href="'+r.userlink+'" class="ff-nickname'+(r.userlink?"":" ff-no-link")+'">'+r.nickname+"</a>":"")+'<a rel="nofollow" href="'+r.permalink+'" class="ff-timestamp">'+r.timestamp+"</a></div></div></div></div>",w++}return n+='<div class="shuffle__sizer"></div></div>',d=a(n),d.find("img").each(function(){var b,c,f=a(this),g=this,h=f.parent(),i=h.is("a")?h:f,j=!0;h.is(".ff-img-holder")||(b=f.css("height"),j=b&&0!=parseInt(b),c=a('<span class="ff-img-holder ff-img-loading" style="width: 100%;max-height: '+(j?b:"none")+'"></span>'),i.wrap(c)),d.each(function(){this.className.indexOf("ff-stream-wrapper")+1&&(e=a(this))}),g.onload=function(){j||a(document).trigger("ffimgloaded",{$grid:e}),f.closest(".ff-img-holder").removeClass("ff-img-loading").addClass("ff-img-loaded")}}),d.find(".ff-filter").click(function(){var b=a(this).attr("data-filter");i(e,b)}),d.find(".ff-search input").on("keyup",function(){var a=this.value.toLowerCase();g(e,a)}),d.on("click","a",function(){var b=a(this);return b.is(".ff-no-link")?!1:void 0}),"nope"===o.gallery&&(d.find(".ff-item").on("click",function(c){var d=a(c.target),e=a(this);d.closest("a").length||b(e.find(".ff-timestamp")[0])}),d.find(".ff-timestamp").click(function(a){a.stopImmediatePropagation()})),"yep"===t.open_in_new&&d.find("a").attr("target","_blank"),q&&(f=o["gf-style"],p(d,f)),"compact"===o.layout&&"c-style-2"===o["compact-style"]&&d.find(".picture-item__inner").each(function(){var b=a(this);b.append(b.find(".ff-item-meta"))}),d}function f(a,b,c,d){setTimeout(function(){j(a,b,c,d)},0)}function g(b,c){clearTimeout(d),k||(b.find(".ff-item").each(o),k=!0),d=setTimeout(function(){g.finder,b.find(".ff-highlight").each(function(){a(this).replaceWith(this.childNodes)}),c&&b.shuffle("shuffle",function(b,d){var e,f;return"all"!==d.group&&-1===a.inArray(d.group,b.data("groups"))?!1:(e=b.find(':contains("'+c+'")'),e.length&&e.first().find("*").filter(function(){var b=a(this);return!b.children().length||b.is("p")}).each(function(b,d){var e=a(d);e.is("p")?g.finder=window.findAndReplaceDOMText(d,{find:new RegExp(c,"i"),wrap:"span",clss:"ff-highlight"}):a(d).html(function(a,b){var d=b.replace(new RegExp(c,"i"),function(a){return'<span class="ff-highlight">'+a+"</span>"});return d})}),e.length||(f=a.trim(b.attr("data-type")).toLowerCase(),f=-1!==f.indexOf(c)),e.length||f)})},200)}function i(b,c){k||(b.find(".ff-item").each(o),k=!0),b.shuffle("shuffle",function(b,d){if("all"!==d.group&&-1===a.inArray(d.group,b.data("groups")))return!1;var e=a.trim(b.attr("data-type")).toLowerCase();return c?-1!==e.indexOf(c):1})}function j(a,b,c,d){var e,f=a.find(".shuffle__sizer"),g=a.find(".ff-item");n(g),d&&!h&&new CBPGridGallery(a.parent()),a.find("p").readmore({maxHeight:200,speed:0,afterToggle:function(){e.layout()}}),a.shuffle({itemSelector:".ff-item",sizer:f}),e=a.data("shuffle"),b&&(b=parseInt(b),a.addClass("ff-slider"),q(a,b,e,c),a.shuffle("shuffle",function(a){return parseInt(a.attr("data-index"))<=b}),a.data("num",g,length),a.data("visible",0)),window.requestAnimationFrame&&m(a,g),a.on("done.shuffle",function(){setTimeout(function(){e.layout()},500)})}function m(a,b){b.each(function(){FF_Viewport.add({element:this,threshold:130,enter:o})})}function n(a){a.find(".picture-item__inner").addClass("picture-item__inner--transition")}function o(){a(this).addClass("in")}function p(b,c){b.find(".ff-item").each(function(b,d){var e,f=a(d),g=f.find(".picture-item__inner"),h=f.find(".ff-img-holder");/[12]/.test(c)?(e=f.find(".ff-item-meta"),f.find(".ff-item-cont").prepend(e),h.length||"style-1"===c&&e.append(e.find(".ff-userpic"))):"style-3"===c&&g.prepend(f.find(".ff-icon")),f.addClass("ff-"+(h.length?"":"no-")+"image"),g.prepend(h)})}function q(b,c,d,e){function f(){var a=k.data("currentSlide"),b=a-1;1>b&&(b=n),k.data("currentSlide",b),i(b),!h&&e&&setTimeout(j,0)}function g(){var a=k.data("currentSlide"),b=a+1;b>n&&(b=1),k.data("currentSlide",b),i(b),!h&&e&&setTimeout(j,0)}function i(d){b.shuffle("shuffle",function(b,e){var f,g,h;return"all"!==e.group&&-1===a.inArray(e.group,b.data("groups"))?!1:(f=b.attr("data-index"),g=c*(d-1),h=c*d,f>g&&h>=f)})}function j(){var c=b.offset().top;a("html, body").animate({scrollTop:c-100},300)}var k,l=a('<span class="ff-control-prev"/>'),m=a('<span class="ff-control-next"/>'),n=Math.ceil(d.$items.length/c);l.on("click",f),m.on("click",g),h&&s(b,f,g),k=a('<div class="ff-controls-wrapper"></div>').append(l).append(m),k.data("currentSlide",1),b.on("layout.shuffle",function(){}),b.append(k)}function r(b,c){b.find("img").each(function(){var b=a(this),d=parseInt(b.css("height")),e=parseInt(b.css("width")),f=c/e;b.css("height",Math.round(d*f)+"px")})}function s(a,b,c){var d,e,f,g,h;a.bind("touchstart",function(a){f=(new Date).getTime(),d=a.originalEvent.touches[0].pageX,e=a.originalEvent.touches[0].clientY}).bind("touchmove",function(a){g=a.originalEvent.touches[0].pageX,h=a.originalEvent.touches[0].clientY}).bind("touchend",function(){var a=g>d?"right":"left",i=h-e>60||-60>h-e,j=g-d>60||-60>g-d,k=(new Date).getTime();if(!(k-f>300||i)&&j)switch(a){case"left":c();break;case"right":b()}})}var t=window.FlowFlowOpts;if(t)return{init:c,buildStreamWith:e,setupGrid:f,reformat:p,adjustImgHeight:r}}(a);window.FlowFlow=l.init()}(jQuery);